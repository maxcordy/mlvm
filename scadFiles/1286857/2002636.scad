
/////////////////////////
//  Customizer Stuff  //
///////////////////////

// How many cards would you like to carry?
card_count = 40; //[30:40 Cards,40:60 Cards,50:80 Cards, 60:100 Cards]

card_type = 69; //[69:With Pro-Sleeves,65:Without Pro-Sleeves]

// Paste your Sencil-o-Matic code here or leave blank
input ="default_TNH";

image_size = 50; // [1:150]

Move_Image_Left_Right = 33; // [-50:50]

Move_Image_Up_Down = 45; // [10:50]

image_rotation = 0; // [0:359]

/////////////////////////
// Beat it Customizer //
///////////////////////

/* [Hidden] */

use <write/Write.scad>
use <MCAD/triangles.scad>
use <utils/build_plate.scad>

stencil_thickness =1.5 ;
offX = 3;
offY = 0;
margin = 10;
dispo_width = image_size;

points_array = (input=="default_TNH"? [[205,208],[[200.77,43.44],[199.19,44.3],[196.01,46.99],[191.68,50.99],[193.55,53.05],[194.78,55.02],[194.39,56.75],[193.34,58.01],[192.26,58.75],[191.3,58.4],[190.52,57.06],[189.37,55.5],[187.18,54.98],[184.97,54.76],[183.43,54.23],[182.43,53.13],[181.54,51.5],[180.72,49.5],[179.96,52],[179.39,54.88],[179.1,58.31],[179.3,60.89],[179.98,61.51],[181.26,61.4],[182.98,61.99],[184.42,63.43],[185,65.4],[184.53,67.2],[182.45,67.24],[180.21,67.31],[178.6,68.53],[176.8,69.81],[173.61,69.71],[169.92,69.11],[173.04,73.06],[175.78,75.84],[177.98,77],[179.42,76.56],[180.36,75.5],[181.23,74.44],[182.5,74],[183.76,74.42],[184.61,75.42],[184.5,77.17],[183.48,79.39],[182.43,81.56],[182.26,83.22],[181.67,84.61],[179.61,86.16],[176.5,87.82],[179.13,88.49],[181.82,88.86],[184.59,88.83],[186.91,88.01],[188,86],[189.01,84.07],[190.79,83.18],[192.57,83.43],[193,85.47],[193.48,88.04],[194.64,90.58],[195.74,93.09],[195.12,95.65],[193.95,98.21],[197.96,95.03],[200.97,92.5],[202.58,90.86],[202.51,89.6],[201.46,87.96],[200.3,86.11],[201.01,84.49],[202.35,83.45],[203.97,84.47],[205.96,85.55],[208.38,86],[210.8,86.66],[212.4,89.1],[213.57,91.25],[214.35,90.52],[214.81,88.07],[215,84.53],[214.57,80.85],[212.5,79.59],[210.58,78.56],[210,76.57],[210.41,74.77],[212.06,74.73],[214,74.59],[215.68,73.04],[217.6,71.37],[220.69,71.47],[224.13,72.12],[223.15,70.31],[221.83,68.37],[220.04,66.25],[218.13,64.66],[216.5,64],[215.16,64.62],[213.94,66.12],[212.8,68.23],[211.17,66.6],[210.09,64.9],[210.77,63],[211.64,60.92],[212,58.69],[212.77,56.54],[215.25,54.8],[218.5,53.23],[214.76,52.51],[211.38,52.18],[208.51,52.41],[206.51,53.53],[206,56.09],[205.63,58.44],[204.25,58.81],[202.87,57.78],[202.17,55.49],[201.38,52.78],[199.93,50.45],[198.03,48.4],[199.62,46.14],[200.61,44.41],[200.77,43.44]],[[197.72,59.03],[194.15,59.37],[191.5,60.16],[189.58,61.56],[187.77,63.38],[186.48,66.25],[186.02,70.53],[186.44,74.78],[187.56,77.78],[189.51,79.8],[192.01,81.51],[194.84,82.56],[197.58,83],[200.43,82.41],[203.53,80.98],[206.31,78.54],[208.44,75.49],[209.52,72],[209.44,68.51],[208.05,65.14],[205.36,62.01],[201.77,59.63],[197.72,59.03]],[[197.67,60.04],[194.61,60.51],[191.7,61.6],[189.45,63.4],[187.95,65.62],[187.28,68.39],[187,71.51],[187.61,74.68],[189.25,77.51],[191.96,79.6],[195.59,80.67],[199.42,80.68],[202.75,79.63],[205.33,77.53],[207,74.51],[207.62,71.16],[207.51,68.02],[206.16,65.18],[203.85,62.53],[200.8,60.68],[197.67,60.04]],[[117,105],[113.52,105.52],[111.04,107.19],[109.6,108.9],[109,109.94],[107.72,110.34],[104.65,110.5],[101.07,110.92],[98.57,111.94],[97.32,113.93],[97.18,117.14],[97.05,120.36],[95.35,121.89],[93.52,123.86],[93.17,129.69],[93.57,135.29],[94.75,138.25],[96.91,139.53],[100.1,140],[102.95,139.71],[104.5,139],[105.64,138.29],[107.5,138],[109.31,138.22],[110.32,138.75],[110.84,140.23],[111.46,142.75],[111.69,145.34],[110.83,146.42],[109.08,146.89],[106.75,147.44],[104.81,148.13],[104,148.95],[104.66,149.8],[106.25,150.55],[108.34,151.48],[110.21,152.74],[111.9,153.62],[113.54,153.62],[115.24,153.49],[117.07,154.04],[118.53,154.57],[119,154.05],[119.51,153.37],[120.75,153.17],[123.45,153.2],[127.5,153.08],[130.66,152.76],[131.25,152.34],[130.37,151.73],[130,150.99],[130.66,150.27],[132.25,149.75],[133.62,149.31],[131.5,148.64],[128.65,147.92],[126,147.19],[123.96,145.9],[123.24,142.98],[123.34,140.08],[123.95,138.01],[126.45,136.86],[133.04,136.63],[141.16,136.75],[142.22,134.41],[142.77,132.23],[142,130.5],[141.2,128.76],[142.02,126.45],[143.35,123.98],[140.82,121.24],[138.86,118.79],[137.68,116.75],[136.96,115.51],[136.1,115],[135.23,114.41],[134.5,112.99],[133.16,111.11],[130.84,109.42],[128.25,108.49],[126.26,108.45],[124.61,108.31],[122.81,107.03],[120.42,105.5],[117,105]],[[288.07,115.2],[287.5,108.61],[283.14,113.56],[278.81,118.81],[274.53,124.5],[271.2,129.74],[269.14,133.9],[268.34,137.59],[268,141.68],[268.43,145.81],[269.46,149.57],[271.43,152.57],[274.43,154.54],[278.35,155.57],[282.85,156],[287.4,155.55],[291.45,154.45],[294.75,152.31],[297.02,148.68],[298.35,144.41],[297.89,139.98],[295.98,134.8],[292.77,128.64],[289.34,121.84],[288.07,115.2]],[[123.96,123.47],[123.28,123.66],[123,124.94],[123.12,126.4],[123.39,127],[123.84,126.57],[124.35,125.53],[124.47,124.32],[123.96,123.47]],[[128.44,130.12],[127.26,130.33],[125.75,130.69],[124.51,131.28],[124,132.07],[124.22,132.72],[124.75,132.97],[125.85,132.51],[127.44,131.47],[128.54,130.47],[128.44,130.12]],[[109.79,131],[109.33,131.29],[109.5,131.99],[110.58,133.04],[112.31,134.14],[114.5,135.29],[112.6,133.15],[110.98,131.63],[109.79,131]],[[292.94,135],[292.09,135.92],[291.1,138.15],[290.5,140.89],[291.12,142.65],[292.3,143.6],[293.56,144],[294.66,143.45],[295.46,142.11],[295.54,140.02],[294.87,137.61],[293.81,135.77],[292.94,135]],[[244.5,198.09],[240.72,198.72],[235.86,200.13],[230.21,202.1],[231.3,204.98],[232.67,207.31],[234.44,208.87],[236.5,209.86],[234.45,209.93],[232.65,209.63],[231.2,208.8],[230.35,207.42],[230,205.8],[229.76,204.53],[229.19,204],[227.86,204.81],[225.8,206.75],[223.51,209.63],[221.61,212.7],[220.47,216.58],[220,221.45],[220.43,226.24],[222,229],[223.95,230.41],[225.85,231],[228.12,231.48],[230.98,232.64],[234.26,234.28],[233.67,240.65],[233.42,245.59],[233.64,248.51],[234.6,249.56],[236.11,250],[237.64,249.24],[238.1,246.25],[238.2,242.5],[239.25,245.75],[240.5,248.17],[242.14,249],[243.56,248.41],[244,246.5],[244.29,244.73],[245,244],[245.71,244.44],[246,245.5],[246.41,246.56],[247.39,247],[248.55,246.56],[249.36,245.5],[250.07,244.44],[250.97,244],[251.7,244.85],[252,246.89],[252.44,249.15],[253.58,250.39],[254.82,250.82],[255.58,251],[255.88,248.51],[256,242.51],[256,234.03],[261.95,232.27],[266.76,230.39],[268.95,228.21],[269.69,225.79],[269.99,223.2],[269.66,220.12],[268.88,216.5],[267.21,212.56],[264.76,208.7],[261.73,205.65],[258.62,205.49],[255.5,206.08],[257.82,204.72],[259.45,203.39],[258.71,202.17],[256.26,200.9],[252.39,199.51],[248.06,198.48],[244.5,198.09]],[[145.57,200.1],[142.67,200.39],[140,200.96],[138.4,201.69],[139,202.32],[141.09,202.99],[144,203.77],[146.41,204.65],[147.28,205.56],[146.38,206.32],[144.51,206.82],[142.88,207.32],[142.54,208.07],[144.93,208.73],[149.87,209],[155.35,209.37],[158.56,210.42],[159.71,211.64],[159.75,212.58],[158.47,212.76],[156.44,212.16],[153.88,210.99],[155.44,213.22],[156.54,215.34],[157,217.32],[157.59,218.79],[159,219.71],[160.53,220.79],[161,223.12],[160.68,225.15],[159.91,226],[158.98,225.42],[158.29,224.01],[157.67,222.77],[156.89,222.57],[156.26,222.49],[156,221.52],[155.6,220.46],[153.99,221],[150.6,221.92],[145.24,222.63],[139.22,223.49],[134.2,224.75],[130.73,226.46],[128.45,228.38],[127.43,230.98],[127,234.32],[127.49,238.08],[128.65,241.68],[130.95,244.86],[134.13,247.58],[138.65,249.54],[145.43,250],[151.39,249.73],[155.2,249.08],[157.41,248.23],[159.5,247.48],[160.1,246.61],[156.5,245.21],[151.5,243.64],[158.45,242.8],[164.03,241.77],[167.67,240.48],[169.59,238.82],[171.05,236.91],[171.73,235.34],[171.8,234.47],[170.39,234.48],[167.5,235],[164.57,235.49],[163.07,235.4],[163.57,234.34],[165.45,232.46],[167.67,230.72],[169,230],[169.82,229.25],[170.84,227.45],[171.66,224.94],[172,222.49],[171.52,219.37],[170.38,215.28],[168.63,211.17],[166.72,208],[165.24,206.4],[165.41,207.5],[166.07,209.79],[166.62,212.5],[167.11,215.5],[165.5,212],[163.58,208.71],[161.24,205.73],[157.9,203.33],[153.61,201.48],[149.2,200.46],[145.57,200.1]],[[136.71,204.06],[134.56,204.35],[132.5,204.95],[130.52,206.52],[128.56,209.11],[126.63,212.44],[129.45,210.22],[131.67,208.65],[133.04,208],[133.46,208.66],[133.4,210.25],[133.27,211.48],[133.56,211.28],[134.98,210.23],[137.57,209.42],[139.99,208.83],[141,208.32],[140.7,207.43],[139.96,205.93],[138.58,204.59],[136.71,204.06]],[[143.01,210.56],[140.52,209.71],[143.07,213.01],[145.5,215.58],[147.78,217.11],[149.8,217.34],[151.52,216.34],[152.54,214.74],[152.78,213.13],[151.7,211.88],[148.98,211.46],[145.79,211.18],[143.01,210.56]],[[232.26,217],[229.12,217.63],[226.45,219.65],[224.72,221.88],[224,223.52],[224.41,224.74],[225.41,225.93],[228.18,226.7],[233.16,226.8],[239.5,226.5],[239.81,223.84],[239.47,221.33],[237.87,219.09],[235.32,217.57],[232.26,217]],[[259.14,217],[255.74,217.54],[253.2,219.29],[251.6,221.63],[250.78,224.04],[250.5,226.5],[255.43,226.81],[259.6,226.86],[262.68,226.54],[264.47,225.51],[265,223.42],[264.7,221.05],[263.96,218.93],[262.29,217.45],[259.14,217]],[[155.81,225.05],[154.5,226.3],[151.77,229.24],[149.27,232.29],[148.48,233.81],[149.17,233.97],[150.21,233.75],[151.8,232.18],[153.81,229.13],[155.36,226.23],[155.81,225.05]],[[243.07,228.08],[242.22,228.1],[241.47,231.38],[241.08,234.8],[241.13,236.4],[242.35,236.8],[244.75,237.33],[248,237.95],[247.93,234.23],[247.63,231.01],[247,228.5],[246.3,227.63],[246.07,230.19],[245.73,232.98],[245,234.5],[244.28,234.14],[243.98,232.31],[243.71,229.91],[243.07,228.08]]]: input);

input_width = points_array[0][0];
input_height= points_array[0][1];
sTrace = dispo_width/input_width;
stencil_height = input_height*sTrace + 2*margin;

/////////////////////////
//   Moduletown USA   //
///////////////////////

module box_lid() {
	difference(){
		cube([card_type + 4,4 + card_count,18]);
		translate([1,1,10]) cube([card_type + 2,2 + card_count,18]);
		translate([2,2,2]) cube([card_type,card_count,18]);
	}
}

module box() {
	translate([4 + card_type,25 + card_count*3,0]) {
		
	rotate([0,0,180]){
	union(){
		translate([0,-10 + card_count,0]){
			difference() {
				translate([0,20,0]) cube([card_type + 4,4 + card_count,87]);
				scale(1.001) translate([card_type + 3.99,19.975,97]) rotate([0,180,0]) box_lid();
				translate([2,22,2]) cube([card_type,card_count,87]); // Inside
				translate([card_type/2-5,25,1]) #write("TNH",h=5,t=.5,font="write/orbitron.dxf");
			}
		}
	translate([card_type/2 + 2,9.8 + card_count,Move_Top_Text_Up_Down]) rotate([90,top_text_rotation,0]) write(top_text_label,h=top_text_size,t=1.5, font=top_text_font, center=true);
	translate([card_type/2 + 2,9.8 + card_count,Move_Bottom_Text_Up_Down]) rotate([90,bottom_text_rotation,0]) write(bottom_text_label,h=bottom_text_size,t=1.5, font=bottom_text_font, center=true);
	translate([Move_Image_Left_Right,9.8 + card_count+2,Move_Image_Up_Down]) rotate([90,image_rotation,0]) pattern();
	}
}
}
}

module pattern(){
	union(){
		translate([0, 0, stencil_thickness/2])
		translate([offX, offY, -stencil_thickness/2])
		scale([sTrace, -sTrace, 1])
		translate([-200, -150, 0]) {
			union() {
				for (i = [1:len(points_array) -1] ) {
					linear_extrude(height=stencil_thickness*2) {polygon(points_array[i]);}
				}
			}
		}
	}
}

//////////////////////////
// Put it all together //
////////////////////////

rotate([0,0,180]){ // Orient to fit build platform
		translate([-card_type/2,-card_count-7,0]){ // Attempt to center at origin
			box();
			scale([1.01,1.01,1.01]) box_lid();
	}
}
